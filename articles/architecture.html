<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Architecture • MCView</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Architecture">
<meta property="og:description" content="MCView">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MCView</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MCView.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Architecture.html">Architecture</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Architecture_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Architecture</h1>
            
      
      
      <div class="hidden name"><code>Architecture.Rmd</code></div>

    </div>

    
    
<p>An <strong>MCView</strong> app needs two components in order to run:</p>
<ol style="list-style-type: decimal">
<li>Configuration file (<code>config.yaml</code>).</li>
<li>Cached data of one or more datasets.</li>
</ol>
<p>The app can use additional files that are not essential:</p>
<ol style="list-style-type: decimal">
<li>
<code>help.yaml</code> - custom help messages.</li>
<li>
<code>about.Rmd</code> - custom “About” page.</li>
</ol>
<p>In order to bundle together the configuration and cached data, <strong>MCView</strong> supports a concept of a ‘project’.</p>
<div id="projects" class="section level2">
<h2 class="hasAnchor">
<a href="#projects" class="anchor"></a>Projects</h2>
<p>A project is a standard library structure that binds config and cache, e.g.:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a>my_project</span>
<span id="cb1-2"><a href="#cb1-2"></a>├── config</span>
<span id="cb1-3"><a href="#cb1-3"></a>│   ├── about.Rmd</span>
<span id="cb1-4"><a href="#cb1-4"></a>│   ├── config.yaml</span>
<span id="cb1-5"><a href="#cb1-5"></a>│   └── help.yaml</span>
<span id="cb1-6"><a href="#cb1-6"></a>└── cache</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="bn">    ├── ko</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="bn">    └── wt</span></span></code></pre></div>
<p>The above example shows the directory structure of a project named <code>my_project</code> that contains two metacell datasets - wt and ko. Multiple functions in the <strong>MCView</strong> package would accept the project path and would expect to find the configuration files and cache in the standard relative path.</p>
<p>Creation of a project can be done by running:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">MCView</span><span class="fu">::</span><span class="fu"><a href="../reference/create_project.html">create_project</a></span><span class="op">(</span><span class="st">"my_project"</span><span class="op">)</span></code></pre></div>
<p>Which would open a text editor in order to edit the configuration file.</p>
</div>
<div id="configuration-files" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration-files" class="anchor"></a>Configuration files</h2>
<p>An <strong>MCView</strong> project can have 3 configuration files:</p>
<ol style="list-style-type: decimal">
<li>config.yaml - main configuration file (required)</li>
<li>help.yaml - help text messages (optional)</li>
<li>about.Rmd - text for the about tab (optional)</li>
</ol>
<p>The main configuration file (<code>config/config.yaml</code>) contains the parameters:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> MCView</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">tabs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"Manifold"</span><span class="kw">,</span><span class="at"> </span><span class="st">"Genes"</span><span class="kw">,</span><span class="at"> </span><span class="st">"Metacells"</span><span class="kw">,</span><span class="at"> </span><span class="st">"Annotate"</span><span class="kw">,</span><span class="at"> </span><span class="st">"About"</span><span class="kw">]</span><span class="co"> # which tabs to show</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">help</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co"> # set to true to show introjs help on start</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="fu">selected_gene1</span><span class="kw">:</span><span class="at"> Foxc1</span><span class="co"> # Default selected gene1 (optional)</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">selected_gene2</span><span class="kw">:</span><span class="at"> Twist1</span><span class="co"> # Default selected gene2 (optional)</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">selected_mc1</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co"> # Default selected metacell1 </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="fu">selected_mc2</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co"> # Default selected metacell2</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="fu">datasets</span><span class="kw">:</span><span class="co"> # optional parameters per dataset</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="at">  </span><span class="fu">PBMC163k</span><span class="kw">:</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="at">    </span><span class="fu">min_d</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span><span class="co"> # default minimal edge distance to show in projection plots</span></span></code></pre></div>
<div id="title" class="section level3">
<h3 class="hasAnchor">
<a href="#title" class="anchor"></a>title</h3>
<p>The title of the app. This would be shown on the top left of the screen.</p>
</div>
<div id="tabs" class="section level3">
<h3 class="hasAnchor">
<a href="#tabs" class="anchor"></a>tabs</h3>
<p>Controls which tabs to show in the left sidebar and their order. Options are:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">[</span><span class="st">"Manifold"</span><span class="kw">,</span><span class="at"> </span><span class="st">"Genes"</span><span class="kw">,</span><span class="at"> </span><span class="st">"Metacells"</span><span class="kw">,</span><span class="at"> </span><span class="st">"Annotate"</span><span class="kw">,</span><span class="at"> </span><span class="st">"About"</span><span class="kw">]</span></span></code></pre></div>
<p>Why would you want to remove tabs?</p>
<p>Many times we would want to separate between a the ‘development’ version of an <strong>MCView</strong> app which allows users to re-annotate the data and a ‘production’ version which only contains data analysis tabs. This can be done by removing “Annotate” from the <code>tabs</code> field. In addition, you might want to always start the app from the “Genes” tab instead of the “Manifold”, which can be done by changing the order in the <code>tabs</code> field.</p>
</div>
<div id="help" class="section level3">
<h3 class="hasAnchor">
<a href="#help" class="anchor"></a>help</h3>
<p>Controls wether to start the app with a help modal (from introjs). Help messages can be edited in <code>help.yaml</code> file (see below).</p>
</div>
<div id="selected_gene1selected_gene2-optional" class="section level3">
<h3 class="hasAnchor">
<a href="#selected_gene1selected_gene2-optional" class="anchor"></a>selected_gene1/selected_gene2 (optional)</h3>
<p>The default genes that would be selected (in any screen with gene selection). If this parameter is missing, the 2 genes with highest max(expr)-min(expr) in the first dataset would be chosen.</p>
</div>
<div id="selected_mc1selected_mc2" class="section level3">
<h3 class="hasAnchor">
<a href="#selected_mc1selected_mc2" class="anchor"></a>selected_mc1/selected_mc2</h3>
<p>The default metacells that would be selected in the Metacells tab.</p>
</div>
<div id="datasets-optional" class="section level3">
<h3 class="hasAnchor">
<a href="#datasets-optional" class="anchor"></a>datasets (optional)</h3>
<p>Additional per-dataset parameters. This is currently a bit degenerated but would include more parameters in the future.</p>
</div>
<div id="help-yaml" class="section level3">
<h3 class="hasAnchor">
<a href="#help-yaml" class="anchor"></a>help.yaml</h3>
<p>This file contains the help messages used by introjs. It shouldn’t be changed in general, except maybe the introduction message. Note that the messages refer to shiny elements, so you would have to look at the code itself in order to identify the element of each message.</p>
</div>
<div id="about-rmd" class="section level3">
<h3 class="hasAnchor">
<a href="#about-rmd" class="anchor"></a>about.Rmd</h3>
<p>This Rmarkdown file contains the contents of the about page. Edit it as you wish, and remember that you can remove the “About” tab altogether using the <code>tabs</code> parameter in <code>config.yaml</code>.</p>
</div>
</div>
<div id="cached-data" class="section level2">
<h2 class="hasAnchor">
<a href="#cached-data" class="anchor"></a>Cached data</h2>
<p>In order to run, <strong>MCView</strong> needs to pre-process the metacell matrix and cluster annotations. This can be done by the <code><a href="../reference/import_dataset.html">MCView::import_dataset</a></code> function which accepts a project path, dataset name and path to the <code>h5ad</code> file that was generated from metacell1.</p>
<p>The cached files would be saved under the cache section in the project folder, in a separate folder for each dataset. In the above example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1"></a>└── cache</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="bn">    ├── ko</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="bn">    └── wt</span></span></code></pre></div>
<p>You can list the datasets in the project using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">MCView</span><span class="fu">::</span><span class="fu"><a href="../reference/dataset_ls.html">dataset_ls</a></span><span class="op">(</span><span class="st">"my_project"</span><span class="op">)</span></code></pre></div>
<p>And removal of a dataset can be done by:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">MCView</span><span class="fu">::</span><span class="fu"><a href="../reference/dataset_rm.html">dataset_rm</a></span><span class="op">(</span><span class="st">"my_project"</span>, <span class="st">"dataset"</span><span class="op">)</span></code></pre></div>
</div>
<div id="running-the-app" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-app" class="anchor"></a>Running the app</h2>
<p>Running the app can be done by running:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">MCView</span><span class="fu">::</span><span class="fu"><a href="../reference/run_app.html">run_app</a></span><span class="op">(</span>project <span class="op">=</span> <span class="st">"/path/to/my/project"</span><span class="op">)</span></code></pre></div>
</div>
<div id="deployment" class="section level2">
<h2 class="hasAnchor">
<a href="#deployment" class="anchor"></a>Deployment</h2>
<p><strong>MCView</strong> can generate a ‘deployment ready’ version of the app by running:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">MCView</span><span class="fu">::</span><span class="fu"><a href="../reference/create_bundle.html">create_bundle</a></span><span class="op">(</span>project <span class="op">=</span> <span class="st">"/path/to/my/project"</span>, path <span class="op">=</span> <span class="st">"/path/to/the/bundle"</span>, name <span class="op">=</span> <span class="st">"my_project"</span><span class="op">)</span></code></pre></div>
<p>This would create a minimal shiny app in “/path/to/the/bundle/my_project” directory which would contain:</p>
<ol style="list-style-type: decimal">
<li>app.R file.</li>
<li>project config and cache.</li>
</ol>
<p>The bundle can then be deployed in shiny-server by running:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rsconnect</span><span class="fu">::</span><span class="fu">deployApp</span><span class="op">(</span>appDir <span class="op">=</span> <span class="st">"/path/to/the/bundle/my_project"</span><span class="op">)</span></code></pre></div>
<p>or any other environment that supports serving shiny apps.</p>
<p>Note that when deploying to these services make sure you have the <strong>MCView</strong> package installed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aviezer Lifshitz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
