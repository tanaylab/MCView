<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Summarise cell metadata for each metacell. Metadata fields can be either numeric and then the summary function func is applied for the values of each field, or categorical metadata fields which are expanded to multiple
metadata columns with the fraction of cells (in each metacell) for every category. Variables that are either character,
factor or are explicitly set at categorical are treated as categorical.

cell_metadata_to_metacell converts cell metadata to metacell metadata from data frames. 
cell_metadata_to_metacell_from_h5ad extracts metadata fields and cell_to_metacell from cells h5ad file and
then runs cell_metadata_to_metacell. 
cell_metadata_to_metacell_from_metacell1 extracts metadata fields and cell_to_metacell from metacell1 scdb and
then runs cell_metadata_to_metacell."><title>Convert cell metadata to metacell metadata — cell_metadata_to_metacell • MCView</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert cell metadata to metacell metadata — cell_metadata_to_metacell"><meta property="og:description" content="Summarise cell metadata for each metacell. Metadata fields can be either numeric and then the summary function func is applied for the values of each field, or categorical metadata fields which are expanded to multiple
metadata columns with the fraction of cells (in each metacell) for every category. Variables that are either character,
factor or are explicitly set at categorical are treated as categorical.

cell_metadata_to_metacell converts cell metadata to metacell metadata from data frames. 
cell_metadata_to_metacell_from_h5ad extracts metadata fields and cell_to_metacell from cells h5ad file and
then runs cell_metadata_to_metacell. 
cell_metadata_to_metacell_from_metacell1 extracts metadata fields and cell_to_metacell from metacell1 scdb and
then runs cell_metadata_to_metacell."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MCView</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/MCView.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Architecture.html">Architecture</a>
    <a class="dropdown-item" href="../articles/Docker.html">Docker</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tanaylab/MCView/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Convert cell metadata to metacell metadata</h1>
      <small class="dont-index">Source: <a href="https://github.com/tanaylab/MCView/blob/HEAD/R/metadata.R" class="external-link"><code>R/metadata.R</code></a></small>
      <div class="d-none name"><code>cell_metadata_to_metacell.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Summarise cell metadata for each metacell. Metadata fields can be either numeric and then the summary function <code>func</code> is applied for the values of each field, or categorical metadata fields which are expanded to multiple
metadata columns with the fraction of cells (in each metacell) for every category. Variables that are either character,
factor or are explicitly set at <code>categorical</code> are treated as categorical.</p>

<p><code>cell_metadata_to_metacell</code> converts cell metadata to metacell metadata from data frames. <br><code>cell_metadata_to_metacell_from_h5ad</code> extracts metadata fields and cell_to_metacell from cells h5ad file and
then runs <code>cell_metadata_to_metacell</code>. <br><code>cell_metadata_to_metacell_from_metacell1</code> extracts metadata fields and cell_to_metacell from metacell1 scdb and
then runs <code>cell_metadata_to_metacell</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cell_metadata_to_metacell</span><span class="op">(</span></span>
<span>  <span class="va">cell_metadata</span>,</span>
<span>  <span class="va">cell_to_metacell</span>,</span>
<span>  func <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cell_metadata_to_metacell_from_metacell1</span><span class="op">(</span></span>
<span>  <span class="va">scdb</span>,</span>
<span>  <span class="va">matrix</span>,</span>
<span>  <span class="va">mc</span>,</span>
<span>  <span class="va">metadata_fields</span>,</span>
<span>  func <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cell_metadata_to_metacell_from_h5ad</span><span class="op">(</span></span>
<span>  <span class="va">anndata_file</span>,</span>
<span>  <span class="va">metadata_fields</span>,</span>
<span>  func <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  rm_outliers <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cell_metadata</dt>
<dd><p>data frame with a column named "cell_id" with
the cell id and other metadata columns, or a name of a delimited file which
contains such data frame.</p></dd>


<dt>cell_to_metacell</dt>
<dd><p>data frame with a column named "cell_id" with cell id and
another column named "metacell" with the metacell the cell is part of, or a
name of a delimited file which contains such data frame.</p></dd>


<dt>func</dt>
<dd><p>summary function for the cell metadata for non categorical metadata columns
(e.g. mean, median, sum)</p></dd>


<dt>categorical</dt>
<dd><p>a vector with names of categorical variables. The returned data frame would have
a column for each category where the values are the fraction of cells with the
category in each metacell.</p></dd>


<dt>scdb, matrix, mc</dt>
<dd><p>scdb, matrix and mc objects from metacell1. See <code>import_dataset_metacell1</code> for more information.</p></dd>


<dt>metadata_fields</dt>
<dd><p>names of fields in the anndata <code>object$obs</code> which contains metadata for each cell.</p></dd>


<dt>anndata_file</dt>
<dd><p>path to <code>h5ad</code> file which contains the output of metacell2 pipeline (metacells python package).</p></dd>


<dt>rm_outliers</dt>
<dd><p>do not calculate statistics for cells that are marked as outliers (<code>outiler=TRUE</code> in <code>object$obs</code>) (only relevant when running <code>cell_metadata_to_metacell_from_h5ad</code>)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame with a column named "metacell" and
the metadata columns from <code>cell_metadata</code> summarized for each metacell using
<code>func</code> for non-categorical variables, and a column for each category of the categorical metadata variables
in<code>cell_metadata</code>, where the values are the fraction of cells with the category in each metacell.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>cell_metadata_to_metacell_from_metacell1()</code>:</p></li>
<li><p><code>cell_metadata_to_metacell_from_h5ad()</code>:</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">60427</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_cells</span> <span class="op">&lt;-</span> <span class="fl">5e6</span></span></span>
<span class="r-in"><span><span class="va">cell_metadata</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span></span>
<span class="r-in"><span>    cell_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_cells</span>,</span></span>
<span class="r-in"><span>    md1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    md2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_cells</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    md_categorical1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"batch"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    md_categorical2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in tibble(cell_id = 1:n_cells, md1 = sample(1:5, size = n_cells,     replace = TRUE), md2 = rnorm(n = n_cells), md_categorical1 = sample(paste0("batch",     1:5), size = n_cells, replace = TRUE), md_categorical2 = sample(1:5,     size = n_cells, replace = TRUE)):</span> could not find function "tibble"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cell_to_metacell</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span></span>
<span class="r-in"><span>    cell_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_cells</span>,</span></span>
<span class="r-in"><span>    metacell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1535</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in tibble(cell_id = 1:n_cells, metacell = sample(0:1535, size = n_cells,     replace = TRUE)):</span> could not find function "tibble"</span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">cell_metadata_to_metacell</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cell_metadata</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    <span class="va">cell_to_metacell</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cell_metadata_to_metacell(cell_metadata[, 1:3], cell_to_metacell):</span> object 'cell_metadata' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in head(metadata):</span> object 'metadata' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">metadata1</span> <span class="op">&lt;-</span> <span class="fu">cell_metadata_to_metacell</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cell_metadata</span><span class="op">[</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">cell_to_metacell</span>,</span></span>
<span class="r-in"><span>    func <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cell_metadata_to_metacell(cell_metadata[, 11:3], cell_to_metacell,     func = function(x) x * 2):</span> object 'cell_metadata' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata1</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in head(metadata1):</span> object 'metadata1' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">metadata3</span> <span class="op">&lt;-</span> <span class="fu">cell_metadata_to_metacell</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cell_metadata</span>,</span></span>
<span class="r-in"><span>    <span class="va">cell_to_metacell</span>,</span></span>
<span class="r-in"><span>    categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"md_categorical1"</span>, <span class="st">"md_categorical2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cell_metadata_to_metacell(cell_metadata, cell_to_metacell, categorical = c("md_categorical1",     "md_categorical2")):</span> object 'cell_metadata' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata3</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in head(metadata3):</span> object 'metadata3' not found</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu">cell_metadata_to_metacell_from_h5ad</span><span class="op">(</span><span class="st">"cells.h5ad"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pile"</span>, <span class="st">"age"</span>, <span class="st">"batch"</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="st">"batch"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Aviezer Lifshitz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

