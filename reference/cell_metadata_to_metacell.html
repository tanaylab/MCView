<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Convert cell metadata to metacell metadata — cell_metadata_to_metacell • MCView</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Convert cell metadata to metacell metadata — cell_metadata_to_metacell"><meta property="og:description" content="Summarise cell metadata for each metacell. Metadata fields can be either numeric and then the summary function func is applied for the values of each field, or categorical metadata fields which are expanded to multiple
metadata columns with the fraction of cells (in each metacell) for every category. Variables that are either character,
factor or are explicitly set at categorical are treated as categorical.

cell_metadata_to_metacell converts cell metadata to metacell metadata from data frames.
cell_metadata_to_metacell_from_h5ad extracts metadata fields and cell_to_metacell from cells h5ad file and
then runs cell_metadata_to_metacell."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MCView</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/MCView.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Architecture.html">Architecture</a>
    </li>
    <li>
      <a href="../articles/Docker.html">Docker</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tanaylab/MCView/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert cell metadata to metacell metadata</h1>
    <small class="dont-index">Source: <a href="https://github.com/tanaylab/MCView/blob/HEAD/R/metadata.R" class="external-link"><code>R/metadata.R</code></a></small>
    <div class="hidden name"><code>cell_metadata_to_metacell.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Summarise cell metadata for each metacell. Metadata fields can be either numeric and then the summary function <code>func</code> is applied for the values of each field, or categorical metadata fields which are expanded to multiple
metadata columns with the fraction of cells (in each metacell) for every category. Variables that are either character,
factor or are explicitly set at <code>categorical</code> are treated as categorical.</p>

<p><code>cell_metadata_to_metacell</code> converts cell metadata to metacell metadata from data frames.
<code>cell_metadata_to_metacell_from_h5ad</code> extracts metadata fields and cell_to_metacell from cells h5ad file and
then runs <code>cell_metadata_to_metacell</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">cell_metadata_to_metacell</span><span class="op">(</span>
  <span class="va">cell_metadata</span>,
  <span class="va">cell_to_metacell</span>,
  func <span class="op">=</span> <span class="va">mean</span>,
  categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">cell_metadata_to_metacell_from_h5ad</span><span class="op">(</span>
  <span class="va">anndata_file</span>,
  <span class="va">metadata_fields</span>,
  func <span class="op">=</span> <span class="va">mean</span>,
  categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,
  rm_outliers <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>cell_metadata</dt>
<dd><p>data frame with a column named "cell_id" with
the cell id and other metadata columns, or a name of a delimited file which
contains such data frame.</p></dd>
<dt>cell_to_metacell</dt>
<dd><p>data frame with a column named "cell_id" with cell id and
another column named "metacell" with the metacell the cell is part of, or a
name of a delimited file which contains such data frame.</p></dd>
<dt>func</dt>
<dd><p>summary function for the cell metadata for non categorical metadata columns
(e.g. mean, median, sum)</p></dd>
<dt>categorical</dt>
<dd><p>a vector with names of categorical variables. The returned data frame would have
a column for each category where the values are the fraction of cells with the
category in each metacell.</p></dd>
<dt>anndata_file</dt>
<dd><p>path to <code>h5ad</code> file which contains the output of metacell2 pipeline (metacells python package).</p></dd>
<dt>metadata_fields</dt>
<dd><p>names of fields in the anndata <code>object$obs</code> which contains metadata for each cell.</p></dd>
<dt>rm_outliers</dt>
<dd><p>do not calculate statistics for cells that are marked as outliers (<code>outiler=TRUE</code> in <code>object$obs</code>) (only relevant when running <code>cell_metadata_to_metacell_from_h5ad</code>)</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data frame with a column named "metacell" and
the metadata columns from <code>cell_metadata</code> summarized for each metacell using
<code>func</code> for non-categorical variables, and a column for each category of the categorical metadata variables
in<code>cell_metadata</code>, where the values are the fraction of cells with the category in each metacell.</p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>cell_metadata_to_metacell_from_h5ad</code>:</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">60427</span><span class="op">)</span></span>
<span class="r-in"><span class="va">n_cells</span> <span class="op">&lt;-</span> <span class="fl">5e6</span></span>
<span class="r-in"><span class="va">cell_metadata</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span class="r-in">    cell_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_cells</span>,</span>
<span class="r-in">    md1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span class="r-in">    md2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_cells</span><span class="op">)</span>,</span>
<span class="r-in">    md_categorical1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"batch"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span class="r-in">    md_categorical2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in tibble(cell_id = 1:n_cells, md1 = sample(1:5, size = n_cells,     replace = TRUE), md2 = rnorm(n = n_cells), md_categorical1 = sample(paste0("batch",     1:5), size = n_cells, replace = TRUE), md_categorical2 = sample(1:5,     size = n_cells, replace = TRUE)):</span> could not find function "tibble"</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">cell_to_metacell</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span class="r-in">    cell_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_cells</span>,</span>
<span class="r-in">    metacell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1535</span>, size <span class="op">=</span> <span class="va">n_cells</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in tibble(cell_id = 1:n_cells, metacell = sample(0:1535, size = n_cells,     replace = TRUE)):</span> could not find function "tibble"</span>
<span class="r-in"><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">cell_metadata_to_metacell</span><span class="op">(</span><span class="va">cell_metadata</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">cell_to_metacell</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cell_metadata_to_metacell(cell_metadata[, 1:3], cell_to_metacell):</span> object 'cell_metadata' not found</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in head(metadata):</span> object 'metadata' not found</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">metadata1</span> <span class="op">&lt;-</span> <span class="fu">cell_metadata_to_metacell</span><span class="op">(</span><span class="va">cell_metadata</span><span class="op">[</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">cell_to_metacell</span>, func <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cell_metadata_to_metacell(cell_metadata[, 11:3], cell_to_metacell,     func = function(x) x * 2):</span> object 'cell_metadata' not found</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata1</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in head(metadata1):</span> object 'metadata1' not found</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">metadata3</span> <span class="op">&lt;-</span> <span class="fu">cell_metadata_to_metacell</span><span class="op">(</span><span class="va">cell_metadata</span>, <span class="va">cell_to_metacell</span>, categorical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"md_categorical1"</span>, <span class="st">"md_categorical2"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cell_metadata_to_metacell(cell_metadata, cell_to_metacell, categorical = c("md_categorical1",     "md_categorical2")):</span> object 'cell_metadata' not found</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata3</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in head(metadata3):</span> object 'metadata3' not found</span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="fu">cell_metadata_to_metacell_from_h5ad</span><span class="op">(</span><span class="st">"cells.h5ad"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pile"</span>, <span class="st">"age"</span>, <span class="st">"batch"</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="st">"batch"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Aviezer Lifshitz.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

